<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ARO CODE</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playwrite+DK+Loopet:wght@100..400&display=swap" rel="stylesheet">





  <script>
    if (localStorage.getItem("acces") !== "true") {
      window.location.href = "access-check.html";
    }

    
  </script>



<script>
  

  let lang = localStorage.getItem("lang") || "ar";

  let pos = "0";

  let rb ="0";


</script>

<SCript>

window.onload = function () {
    document.getElementById("BRAN").click();
    

    
  };



</SCript>


  <style>
    body {

      background: url('https://png.pngtree.com/thumb_back/fh260/background/20200214/pngtree-seamless-repeat-pattern-with-flowers-and-leaves-scandinavian-childish-drawing-background-image_329833.jpg') repeat ; 
   /*  background-size: 100%;
    */
    

      font-family: 'Cairo', sans-serif;
      background-color: white;
      direction: rtl;
      margin: 0;
      padding: 0PX;
    }




   




    .container {

/*
      background-image: url('https://www2.0zz0.com/2025/04/29/07/744854888.png');
  background-repeat: no-repeat;
  background-position: center top;
  background-size: contain;
  */    
 

    
      max-width: 1200px;
      min-height: 100vh;
      height: 100%;
      margin: 0 auto;
      margin-top: 0PX;



/*
      
      background: linear-gradient(
  to right,
  rgba(255, 255, 255, 0),
  rgba(255, 255, 255, 0.01) ,
  rgba(255, 255, 255, 0.02) ,
  rgba(255, 255, 255, 0.03) ,
  rgba(255, 255, 255, 0.9) ,

  rgba(255, 255, 255, 0.9),
  rgba(255, 255, 255, 0.9),
 






);    backdrop-filter: blur(1px); /* تمويه خلفي أنيق */
 /*   -webkit-backdrop-filter: blur(1px); /* دعم لسفاري */



    background-color: rgba(255, 255, 255, 0.9); /* أبيض شفاف بنسبة 30% */
    backdrop-filter: blur(1px); /* تمويه خلفي أنيق */
    -webkit-backdrop-filter: blur(1px); /* دعم لسفاري */

    
      padding: 20px;

      padding-left: 0px;
      padding-right: 0px;
      padding-top: 0px;


      

      


    }









    

    h2 {


  font-family: "Playwrite DK Loopet", cursive;

   /*  font-family: "Kaushan Script", cursive;
*/

      


      text-align: center;
      color: rgb(30, 99, 30);
      font-size: 40PX;

      font-weight: bold;
      margin-top: 0px;
      margin-right: 0;
      padding-top: 2vh;
      padding-bottom: 2vh;
      margin-bottom: 0px;
    }

    input[type="text"] {
      width: 100%;
      padding: 0px;
      font-size: 16px;
      border: 1px solid #cccccc;
      border-radius: 0px;
      box-sizing: border-box;
      font-family: 'Cairo', sans-serif; /* أضف هذا السطر */
     padding-top: 5PX;
     padding-bottom: 5PX;

    

    }

    
    .rtl-input {
      direction: rtl;
      text-align: center;
      margin-top: 5px;
    }

    #imageUrl {
      direction: ltr;
      text-align: center;
    }

    button {
      width: 100%;
      padding: 0px;
      background: linear-gradient(to right, #62929e, #0d323b);
      
     background-color: rgb(43, 93, 94);
     color: white;
      border: none;
      border-radius: 7px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 10px;
      box-shadow: 0 4px 10px rgba(68, 0, 255, 0.3);
      transition: background 0.3s ease;
      font-family: 'Cairo', sans-serif; /* أضف هذا السطر */
      font-weight: bold;
     width: 97%;

    }

  /*  button:hover {
      background: linear-gradient(to right, #3333aa, #6600cc);
    }
*/
    #message {
      color: red;
      text-align: center;
      font-weight: bold;
      display: none;
      margin-top: 10px;
    }

    #resultsCount {
      color: #006400;
      text-align: center;
      font-weight: bold;
      margin-top: 10px;
      display: none;
    }

    #welcomeText {
      text-align: center;
      font-size: 24px;
      margin-top: 20px;
      font-weight: bold;
      
    }

    .image-container {
      text-align: center;
      margin-top: 20px;


    }

    .image-container img {
      margin: 0 auto 10px; /* auto على الجانبين للتوسيط الأفقي */


     
      min-width: 200px;
      max-width: 20vw;
      margin-bottom: 10px;
      border-radius: 10px;
      display: none;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
    }

    .image-container img.show {
      display: block;
      opacity: 1;
    }

    #infoText {
      text-align: center;
      color: #555;
      margin-bottom: 10px;
      display: none;
    }

    #externalLink {
      text-align: center;
      margin-top: 10px;
      display: none;
    }

    #externalLink a {
      color: blue;
      text-decoration: none;
    }

    .result-item {
      background: rgba(255, 255, 255, 0.7);
      padding: 15px;
      margin: 15px;
      margin-left: 10px;
      margin-right: 10px;
      border-radius: 15px;
      border: 2px solid #ccc;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1), 0 0 10px rgba(255, 255, 255, 0.4) inset;
      backdrop-filter: blur(6px);
      transition: transform 0.2s ease;
      text-align: center;
    }

  /*  .result-item:hover {
      animation: pulse 0.2s ease;
    }

    @keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.01); }
  100% { transform: scale(1); }
}

*/
    .toggle-btn {
      margin-top: 10px;
      background-color: #888;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 7px;
      cursor: pointer;
      font-size: 14px;
      display: none;
    }

    .toggle-btn:hover {
      background-color: #555;
    }

    .result-details {
      display: block;
      margin-top: 10px;
    }

    .search-group {
      display: flex;
      flex-direction: column;
      gap: 20px;
      text-align: center;
    }

    .search-group > div {
      margin: 0 auto;
      width: 100%;
    }


    .spinner-container {
  text-align: center;
  margin-top: 20px;
  color: #444;
  font-weight: bold;
}

.spinner {
  margin: 0 auto 10px;
  width: 24px;
  height: 24px;
  border: 5px solid #ccc;
  border-top: 5px solid  #0d323b;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}







#brandDropdown {
    width: 100%;
   height: 50PX;
  /*  padding: 10px 15px;
  */  
  border-radius: 12px;
    border: 1.5px solid #85cad3;
    background-color: #fff;
    box-shadow: 0 4px 8px rgb(0 0 0 / 0.1);
    font-size: 16px;
    color: #333;
   /* transition: border-color 0.3s ease, box-shadow 0.3s ease;
   */
   cursor: pointer;
    
  font-family: 'Cairo', sans-serif; /* أضف هذا السطر */
  direction: rtl;
  text-align: right;

  }
/*
  #brandDropdown:hover, #brandDropdown:focus {
    border-color: #5a8dee;
    box-shadow: 0 0 8px #5a8dee88;
    outline: none;
  }
*/
  /* لون العنصر المحدد */

  /*
  #brandDropdown option:checked {
    font-weight: bold;
    color: #666;
  }
*/
  /* نص الخيار الافتراضي */
/*  #brandDropdown option:first-child {
    font-weight: bold;
    color: #666;
  }

*/
.fav-btn {
  font-size: 20px;
  background: none;
  border: none;
  cursor: pointer;
  color: rgb(0, 0, 0);
  transition: transform 0.2s ease;
}

.fav-btn.active {
  color: gold;
}



.lang-container {
  
      width: 60px;
      height: 30px;
      padding-left: 10px;
      padding-right: 10px;
      padding-top: 0px;
      padding-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 10px; /* مسافة بين الزر والعلم */
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      background-color: white;
      
    }

    .circle {
      width: 15px;
      height: 15px;
      border-radius: 50%;
      overflow: hidden;
      border: 1px solid rgb(43, 93, 94);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 6px;
    }

    .circle img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    #lan {
      width: 30px;
      height: 30px;
      margin-right: 0;
      margin-bottom: 0;
      justify-content: center;
      align-items: center;
      background: rgb(255, 253, 253);
      color: rgb(43, 93, 94);
      border-radius: 0;
      font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
      box-shadow: none;
    }





  </style>




<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
  import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-database.js";

  // إعداد Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyADi4u5lGHk9z6ZR8JyeQDkAkU2BFZcm00",
    authDomain: "arocode-dc99f.firebaseapp.com",
    projectId: "arocode-dc99f",
    storageBucket: "arocode-dc99f.appspot.com",
    messagingSenderId: "330058158570",
    appId: "1:330058158570:web:7bd409dd016a2951262293",
    databaseURL: "https://arocode-dc99f-default-rtdb.firebaseio.com"
  };

  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);

  const pNum = localStorage.getItem("pNum");
  const acces = localStorage.getItem("acces");
  const outputDiv = document.getElementById("output");

  if (!pNum) {
    localStorage.removeItem("pNum");
    localStorage.removeItem("acces");
    window.location.href = "access-check.html";
  } else {
    const phoneRef = ref(database, 'USER/' + pNum);

    // مراقبة التغيرات على الرقم في قاعدة البيانات
    onValue(phoneRef, (snapshot) => {
      if (snapshot.exists()) {
        const userData = snapshot.val();
        const userState = userData.STATE;

        if (userState === "Y") {
          outputDiv.innerHTML = `<div class="number">${pNum}</div>`;
        } else {
          localStorage.removeItem("pNum");
          localStorage.removeItem("acces");
          window.location.href = "access-check.html";
        }
      } else {
        localStorage.removeItem("pNum");
        localStorage.removeItem("acces");
        window.location.href = "access-check.html";
      }
    }, {
      onlyOnce: false // الاستماع المستمر لأي تغيير
    });
  }





 

</script>























  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyADi4u5lGHk9z6ZR8JyeQDkAkU2BFZcm00",
      authDomain: "arocode-dc99f.firebaseapp.com",
      projectId: "arocode-dc99f",
      storageBucket: "arocode-dc99f.appspot.com",
      messagingSenderId: "330058158570",
      appId: "1:330058158570:web:7bd409dd016a2951262293",
      databaseURL: "https://arocode-dc99f-default-rtdb.firebaseio.com"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);




 
    function normalize2(text) {
      return (text || "")
        
    }



    function normalize(text) {
      return (text || "")
        .toLowerCase()
        .replace(/[أإآا]/g, 'ا')
        .replace(/[ًٌٍَُِّْ]/g, '')
        .replace(/ة/g, 'ه')
        .replace(/ى/g, 'ي')
        .replace(/^ال/, '')
        .trim();
    }

    function showMessage(text) {
      const message = document.getElementById("message");
      message.textContent = text;
      message.style.display = "block";
    }

    function hideMessage() {
      const message = document.getElementById("message");
      message.style.display = "none";
    }

    function showLoading() {
  document.getElementById("loading").style.display = "block";
}

function HID() {
  document.getElementById("image1").style.display = "none";
      document.getElementById("image2").style.display = "none";
      document.getElementById("welcomeText").style.display = "none";
      document.getElementById("infoText").style.display = "none";
      document.getElementById("externalLink").style.display = "none";

      const input = document.getElementById("arabicSearch").value.trim();
      const results = document.getElementById("searchResults");
      const resultsCount = document.getElementById("resultsCount");
      results.innerHTML = "";
      resultsCount.style.display = "none";

}

function hideLoading() {
  document.getElementById("loading").style.display = "none";
}


    function displayImages(url1, url2, title, link, info ,infoe, urle) {
      const image1 = document.getElementById("image1");
      const image2 = document.getElementById("image2");
      const welcomeText = document.getElementById("welcomeText");
      const infoText = document.getElementById("infoText");
      const externalLink = document.getElementById("externalLink");
      const linkElement = document.getElementById("linkElement");

      image1.style.display = url1 ? "block" : "none";
      if (url1) {
        image1.src = url1;
        image1.classList.add("show");
      }

      if (lang === "ar") {

        
      welcomeText.style.display = title ? "block" : "none";
      if (title) welcomeText.textContent = title;

      infoText.style.display = info ? "block" : "none";
      if (info) infoText.textContent = info;


      externalLink.style.display = link ? "block" : "none";
      if (link) {
        linkElement.href = link;
        linkElement.textContent = "اضغط هنا للمزيد";
      }


    } else {

      welcomeText.style.display = title ? "block" : "none";
      if (url2) welcomeText.textContent = url2;


      infoText.style.display = info ? "block" : "none";
      if (infoe) infoText.textContent = infoe;


      externalLink.style.display = urle ? "block" : "none";
      if (urle) {
        linkElement.href = urle;
        linkElement.textContent = "Click Here For More";
      }
      

    }
 
    }

    function fetchDataByCode(code) {
      showLoading();
      hideMessage();
      document.getElementById("searchResults").innerHTML = "";
      document.getElementById("resultsCount").style.display = "none";
      document.getElementById("image1").style.display = "none";
      document.getElementById("image2").style.display = "none";
      document.getElementById("welcomeText").style.display = "none";
      document.getElementById("infoText").style.display = "none";
      document.getElementById("externalLink").style.display = "none";

      if (!code) {
        hideLoading();

        if ( lang === "ar"){
          showMessage("برجاء إدخال الكود");
          return;

        } else {
          showMessage("Please Enter The Code");
          return;
          
        }
        
      }

      const dataRef = ref(db, "formData/" + code);
      get(dataRef).then((snapshot) => {
        hideLoading();
        if (snapshot.exists()) {
          const data = snapshot.val();
          displayImages(data.field3, data.field5, data.field2, data.field6, data.field4, data.field7 , data.field8);
        } else {
          hideLoading();

          if (lang === "ar"){
            showMessage("لم يتم العثور على الكود");


          }else {
            showMessage("Code Not Found");


          }
        }
      });
    }



    function HIDD() {
   /*   showLoading();
   */
      document.getElementById("image1").style.display = "none";
      document.getElementById("image2").style.display = "none";
      document.getElementById("welcomeText").style.display = "none";
      document.getElementById("infoText").style.display = "none";
      document.getElementById("externalLink").style.display = "none";

      const input = document.getElementById("arabicSearch").value.trim();
      
    /*  let input = document.getElementById("arabicSearch").value.trim();
if (!input.startsWith("من ")) {
  input = "من " + input;
}

    */ 
     
     
      const results = document.getElementById("searchResults");
      const resultsCount = document.getElementById("resultsCount");
      results.innerHTML = "";
      resultsCount.style.display = "none";

      if (input === "") {
        hideLoading();
        showMessage("أدخل كلمات للبحث");
        return;
      }
      const words = input.split(" ").map(w => normalize(w));

   /*   const words = input.split(" ");
*/
      get(ref(db, "formData")).then((snapshot) => {
        
        hideLoading();
        if (snapshot.exists()) {
          let matches = [];

          snapshot.forEach((child) => {
            const data = child.val();
            const code = child.key;

            const field2 = normalize(data.field2 || "");
            const field4 = normalize(data.field4 || "");
            const combined = `${field2} ${field4}`;

            
         /*   if (combined.includes(input)) {
        matches.push({ code, data });
      }
    });*/
            const allWordsMatch = words.every(word => combined.includes(word));
            if (allWordsMatch) {
              matches.push({ code, data });
              
            }
          });

          if (matches.length === 0) {
            hideLoading();
            showMessage("لا توجد نتائج تطابق الكلمات المدخلة");
            return;
          }


     




          // استخراج ما بعد "من" من field2
const brandsSet = new Set();

if (lang ==="ar"){

  
matches.forEach(({ data }) => {
  const text = data.field2 || "";
  const index = text.lastIndexOf("من");
  if (index !== -1) {
    const after = text.slice(index + 2).trim();
    if (after) brandsSet.add(after);
  }
});
} else{
matches.forEach(({ data }) => {
  const text = data.field5 || "";
  const index = text.lastIndexOf("By");
  if (index !== -1) {
    const after = text.slice(index + 2).trim();
    if (after) brandsSet.add(after);
  }
});

}
        if (lang === "ar") {
         
   
// تعبئة القائمة المنسدلة

const brandDropdown = document.getElementById("brandDropdown");
brandDropdown.innerHTML = `<option value="">اختر بيت الازياء</option>`;

// تحويل Set إلى Array وترتيبها أبجديًا (مع دعم للغة العربية)
const sortedBrands = Array.from(brandsSet).sort((a, b) => a.localeCompare(b, 'ar'));

sortedBrands.forEach(brand => {
  const option = document.createElement("option");
  option.value = brand;
  option.textContent = brand;
  
  brandDropdown.appendChild(option);

  
 /* document.getElementById("brandDropdown").options[0].text = "اختر بيت الأزياء";
*/
});




        } else {
         

             
// تعبئة القائمة المنسدلة

 const brandDropdown = document.getElementById("brandDropdown");
brandDropdown.innerHTML = `<option value="">Choose The Brand</option>`;

// تحويل Set إلى Array وترتيبها أبجديًا (مع دعم للغة العربية)
const sortedBrands = Array.from(brandsSet).sort((a, b) => a.localeCompare(b, 'ar'));

sortedBrands.forEach(brand => {
  const option = document.createElement("option");
  option.value = brand;
  option.textContent = brand;
  
  brandDropdown.appendChild(option);

  
 /* document.getElementById("brandDropdown").options[0].text = "اختر بيت الأزياء";
*/
});


        }




brandDropdown.style.display = brandsSet.size > 0 ? "inline-block" : "none";

brandDropdown.style.color = "#333"; // أو أي لون تريده








          const grouped = {};
          matches.forEach(({ code, data }) => {
            

            const name = data.field2 || "بدون اسم";

            if (!grouped[name]) {
              grouped[name] = { data, codes: [] };
            }
            grouped[name].codes.push(code);
          });

        /*  resultsCount.textContent = `✅ تم العثور على ${Object.keys(grouped).length} نتيجة`;
          resultsCount.style.display = "block";
*/
Object.entries(grouped)
  .sort((a, b) => {
    // نحصل على أقل كود نصيًا داخل كل مجموعة
    const minCodeA = a[1].codes.slice().sort((x, y) => x.localeCompare(y))[0];
    const minCodeB = b[1].codes.slice().sort((x, y) => x.localeCompare(y))[0];

    // نرتب تنازليًا حسب أقل كود
    return minCodeB.localeCompare(minCodeA);
  })
  .forEach(([name, { data, codes }]) => {
    // ترتيب الأكواد داخل كل مجموعة (اختياري: من الأكبر للأصغر)
    codes.sort((a, b) => b.localeCompare(a));

            toggleBtn.onclick = () => {
              const isVisible = details.style.display === "block";
              details.style.display = isVisible ? "none" : "block";
              toggleBtn.textContent = isVisible ? "عرض التفاصيل" : "إخفاء التفاصيل";
            
    };

            item.appendChild(toggleBtn);
            item.appendChild(details);
            results.appendChild(item);
          });
        }
      });
    }



    function searchByText() {


      showLoading();
      hideMessage();
      document.getElementById("image1").style.display = "none";
      document.getElementById("image2").style.display = "none";
      document.getElementById("welcomeText").style.display = "none";
      document.getElementById("infoText").style.display = "none";
      document.getElementById("externalLink").style.display = "none";

      const input = document.getElementById("arabicSearch").value.trim();
      const results = document.getElementById("searchResults");
      const resultsCount = document.getElementById("resultsCount");
      results.innerHTML = "";
      resultsCount.style.display = "none";

      if (input === "") {
        hideLoading();
        if(lang === "ar"){

          showMessage("أدخل كلمات للبحث");
          return;
        } else {
          showMessage("Enter Search Words");
          return;
        }
        
      }

      const words = input.split(" ").map(w => normalize(w));

      get(ref(db, "formData")).then((snapshot) => {
        
        hideLoading();
        if (snapshot.exists()) {
          let matches = [];

          snapshot.forEach((child) => {
            const data = child.val();
            const code = child.key;

            const field2 = normalize(data.field2 || "");
            const field4 = normalize(data.field4 || "");

            const field5 = normalize(data.field5 || "");
            const field7 = normalize(data.field7 || "");

            const combined = `${field2} ${field4} ${field5} ${field7}`;

            
            const allWordsMatch = words.every(word => combined.includes(word));
            if (allWordsMatch) {
              matches.push({ code, data });
              
            }
          });

          if (matches.length === 0) {
            hideLoading();

            if(lang === "ar"){
              showMessage("لا توجد نتائج تطابق الكلمات المدخلة");
              return;

            }else{
              showMessage("No Results Match The Entered Words");
              return;

            }
            
          }


     




          const grouped = {};

          if (lang === "ar") {

          matches.forEach(({ code, data }) => {

            

            const name = data.field2 || " ";

            if (!grouped[name]) {
              grouped[name] = { data, codes: [] };
            }
            grouped[name].codes.push(code);
          });

          } else {

            matches.forEach(({ code, data }) => {
  

            const name = data.field5 || " ";

            if (!grouped[name]) {
              grouped[name] = { data, codes: [] };
            }
            grouped[name].codes.push(code);
            });


            
          }


        
            if (lang === "ar"){

              resultsCount.textContent = `✅ تم العثور على ${Object.keys(grouped).length} نتيجة`;
              resultsCount.style.display = "block";
            } else {
              resultsCount.textContent = ` Found  ${Object.keys(grouped).length} Results ✅`;
              resultsCount.style.display = "block";

            }

            Object.entries(grouped)
  .sort((a, b) => {
    // نحصل على أقل كود نصيًا داخل كل مجموعة
    const minCodeA = a[1].codes.slice().sort((x, y) => x.localeCompare(y))[0];
    const minCodeB = b[1].codes.slice().sort((x, y) => x.localeCompare(y))[0];

    // نرتب تنازليًا حسب أقل كود
    return minCodeB.localeCompare(minCodeA);
  })
  .forEach(([name, { data, codes }]) => {
    // ترتيب الأكواد داخل كل مجموعة (اختياري: من الأكبر للأصغر)
    codes.sort((a, b) => b.localeCompare(a));



   
    /*

          Object.entries(grouped)
  .sort((a, b) => {
    const codeA = a[1].codes.sort((x, y) => y.localeCompare(x))[0]; // أعلى كود في المجموعة A
    const codeB = b[1].codes.sort((x, y) => y.localeCompare(x))[0]; // أعلى كود في المجموعة B
    return codeB.localeCompare(codeA); // ترتيب تنازلي حسب الكود
  })
  .forEach(([name, { data, codes }]) => {
    
    codes.sort((a, b) => b.localeCompare(a)); // ترتيب الأكواد أيضًا من Z إلى A
*/

    const item = document.createElement("div");
    item.className = "result-item";

/*
// زر المفضلة
const favBtn = document.createElement("div");
favBtn.className = "fav-btn";
favBtn.innerHTML = "☆"; // نجمة مفرغة
favBtn.title = "أضف إلى المفضلة";

// التحقق من الحالة المحفوظة
const favKey = `fav-${name}`;
if (localStorage.getItem(favKey) === "true") {
  favBtn.classList.add("active");
  favBtn.innerHTML = "★"; // نجمة ممتلئة
}

// عند الضغط على زر المفضلة
favBtn.onclick = () => {
  const isFav = favBtn.classList.toggle("active");
  favBtn.innerHTML = isFav ? "★" : "☆";
  localStorage.setItem(favKey, isFav);
};
*/

    item.innerHTML = `<strong>${name}</strong>
    <br><div style="margin: 5px 0;"><strong>
      ${codes.join(" , ")}</strong></div>`;



     

    const toggleBtn = document.createElement("button");
    toggleBtn.className = "toggle-btn";
    toggleBtn.textContent = "عرض التفاصيل";


    const details = document.createElement("div");
    details.className = "result-details";
    
    
    if (lang === "ar") {

    details.innerHTML = 
    
    `
      <div class="image-container">
        ${data.field3 ? `<img src="${data.field3}" class="show" />` : ""}
        <p>${data.field4 || ""}</p>
        ${data.field6 ? `<a href="${data.field6}" target="_blank">اضغط هنا للمزيد</a>` : ""}
      </div>
    `;
    } else{

      details.innerHTML = 

`
      <div class="image-container">
        ${data.field3 ? `<img src="${data.field3}" class="show" />` : ""}
        <p>${data.field7 || ""}</p>
        ${data.field8 ? `<a href="${data.field8}" target="_blank">Click Here For More</a>` : ""}
      </div>
    `;


    }







            toggleBtn.onclick = () => {
              const isVisible = details.style.display === "block";
              details.style.display = isVisible ? "none" : "block";
              toggleBtn.textContent = isVisible ? "عرض التفاصيل" : "إخفاء التفاصيل";
            
    };
/*
    item.appendChild(favBtn);
*/



            item.appendChild(toggleBtn);
            item.appendChild(details);
            results.appendChild(item);
          });
        }
      });
    }
  
  





    function FROM() {





      
      showLoading();
      hideMessage();
      document.getElementById("image1").style.display = "none";
      document.getElementById("image2").style.display = "none";
      document.getElementById("welcomeText").style.display = "none";
      document.getElementById("infoText").style.display = "none";
      document.getElementById("externalLink").style.display = "none";

      let input = document.getElementById("arabicSearch").value.trim();

      if(lang === "ar"){

if (!input.startsWith("من ")) {
  input = "من " + input;
}
      } else {
if (!input.startsWith("By ")) {
  input = "By " + input;
}

      }

      

  


      const results = document.getElementById("searchResults");
      const resultsCount = document.getElementById("resultsCount");
      results.innerHTML = "";
      resultsCount.style.display = "none";


      

    

      const words = input.split(" ");

      get(ref(db, "formData")).then((snapshot) => {
        
        hideLoading();
        if (snapshot.exists()) {
          let matches = [];

          snapshot.forEach((child) => {
            const data = child.val();
            const code = child.key;

            const field2 = normalize2(data.field2 || "");
            const field5 = normalize2(data.field5 || "");

            const combined = `${field2}  ${field5}`;

            
            if (combined.includes(input)) {
        matches.push({ code, data });
      }
    });

          if (matches.length === 0) {
            hideLoading();
            showMessage("لا توجد نتائج تطابق الكلمات المدخلة");
            return;
          }


     






          const grouped = {};

if (lang === "ar") {

matches.forEach(({ code, data }) => {

  

  const name = data.field2 || " ";

  if (!grouped[name]) {
    grouped[name] = { data, codes: [] };
  }
  grouped[name].codes.push(code);
});

} else {

  matches.forEach(({ code, data }) => {

  

const name = data.field5 || " ";

if (!grouped[name]) {
grouped[name] = { data, codes: [] };
}
grouped[name].codes.push(code);
});


  
}



  if (lang === "ar"){

    resultsCount.textContent = `✅ تم العثور على ${Object.keys(grouped).length} نتيجة`;
    resultsCount.style.display = "block";
  } else {
    resultsCount.textContent = ` Found  ${Object.keys(grouped).length} Results ✅`;
    resultsCount.style.display = "block";

  }


  Object.entries(grouped)
  .sort((a, b) => {
    // نحصل على أقل كود نصيًا داخل كل مجموعة
    const minCodeA = a[1].codes.slice().sort((x, y) => x.localeCompare(y))[0];
    const minCodeB = b[1].codes.slice().sort((x, y) => x.localeCompare(y))[0];

    // نرتب تنازليًا حسب أقل كود
    return minCodeB.localeCompare(minCodeA);
  })
  .forEach(([name, { data, codes }]) => {
    // ترتيب الأكواد داخل كل مجموعة (اختياري: من الأكبر للأصغر)
    codes.sort((a, b) => b.localeCompare(a));


const item = document.createElement("div");
item.className = "result-item";

item.innerHTML = `<strong>${name}</strong>
<br><div style="margin: 5px 0;"><strong>
${codes.join(" , ")}</strong></div>`;





const toggleBtn = document.createElement("button");
toggleBtn.className = "toggle-btn";
toggleBtn.textContent = "عرض التفاصيل";


const details = document.createElement("div");
details.className = "result-details";


if (lang === "ar") {

details.innerHTML = 

`
<div class="image-container">
${data.field3 ? `<img src="${data.field3}" class="show" />` : ""}
<p>${data.field4 || ""}</p>
${data.field6 ? `<a href="${data.field6}" target="_blank">اضغط هنا للمزيد</a>` : ""}
</div>
`;
} else{

details.innerHTML = 

`
<div class="image-container">
${data.field3 ? `<img src="${data.field3}" class="show" />` : ""}
<p>${data.field7 || ""}</p>
${data.field8 ? `<a href="${data.field8}" target="_blank">Click Here For More</a>` : ""}
</div>
`;


}







  toggleBtn.onclick = () => {
    const isVisible = details.style.display === "block";
    details.style.display = isVisible ? "none" : "block";
    toggleBtn.textContent = isVisible ? "عرض التفاصيل" : "إخفاء التفاصيل";
  
};

  item.appendChild(toggleBtn);
  item.appendChild(details);
  results.appendChild(item);
});
}
});
}









    document.addEventListener("DOMContentLoaded", () => {
      const codeInput = document.getElementById("imageUrl");
      const textInput = document.getElementById("arabicSearch");

      

      document.getElementById("searchButton").addEventListener("click", () => {
        pos = "1";
        const code = codeInput.value.trim().toUpperCase();
        fetchDataByCode(code);
        
        codeInput.blur();
      });

      document.getElementById("arabicSearchBtn").addEventListener("click", () => {
        searchByText();
        textInput.blur();
      });

      document.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          if (document.activeElement === codeInput) {
            document.getElementById("searchButton").click();
            codeInput.blur();
            HID();
          } else if (document.activeElement === textInput) {
            document.getElementById("arabicSearchBtn").click();
            textInput.blur();
          }
        }
      });
    });


    
    

   


    document.getElementById("BRAN").addEventListener("click", () => {
  const inputField = document.getElementById("arabicSearch");
  inputField.value = "ر";
  HIDD();



  // إخفاء القيمة مباشرة بعد بدء البحث
  setTimeout(() => {
    inputField.value = "";
  }, 1);

  
});



   

    document.getElementById("searchRButton").addEventListener("click", () => {
  const inputField = document.getElementById("arabicSearch");
  inputField.value = "ر";
  searchByText();

  // إخفاء القيمة مباشرة بعد بدء البحث
  setTimeout(() => {
    inputField.value = "";
  }, 1);

  // إخفاء الزر
 // document.getElementById("searchRButton").style.display = "none";
});

document.getElementById("brandDropdown").addEventListener("change", function () {
  const selectedValue = this.value;
  if (selectedValue) {
    const inputField = document.getElementById("arabicSearch");
    inputField.value = selectedValue;
   FROM();
   this.blur();

 /*  document.getElementById("customDropdown").classList.remove("show");
*/
    // تفريغ حقل البحث بعد التنفيذ
    setTimeout(() => {
      inputField.value = "";
    }, 1);

    // إعادة تعيين اختيار القائمة إلى الخيار الأول بعد التنفيذ
  /* setTimeout(() => {
      this.value = ""; // يعيد عرض "اختر من القائمة"
    }, 100);
  */}
});



document.getElementById("lan").addEventListener("click", () => {
    // تبديل القيمة
    lang = (lang === "ar") ? "en" : "ar";
    localStorage.setItem("lang", lang);
    window.location.reload();


  });




  </script>
</head>


<body>
<!--
  
  <button id="showFavoritesBtn" style="margin: 10px; padding: 8px 12px;">📌 عرض المفضلات</button>
-->




  <div class="container" id="arcon" style="display: block;">    


    
    <div class="lang-container">
      <button id="lan"></button>
      <div class="circle">
        <img  id="flagIcon" src="https://upload.wikimedia.org/wikipedia/commons/f/fe/Flag_of_Egypt.svg" alt="علم مصر">
      </div>
    </div>
    


      <h2 id="logoc" style="
      
      color: rgb(43, 87, 61);
      
      ">Aro Code</h2>

    
    

    <div class="search-group">
      <div>
        <input type="text" id="imageUrl" placeholder="أدخل الكود" />
        <button id="searchButton">بحث بالكود</button>
      </div>

      <div>
        <input type="text" id="arabicSearch" class="rtl-input" placeholder=" ادخل اسم الصنف  بيت الازياء  المكونات" />
        <button id="arabicSearchBtn">بحث</button>

        <button id="BRAN" hidden style="margin-top: 15px; background: #85cad3; color: rgb(36, 44, 0);">BRAND</button>




        <div style="display: flex; align-items: center; gap: 10px; margin-top:0PX;">

          <button id="searchRButton" style="margin-top: 0px; margin-right: 10px; font-size: 14px; height: 48px; max-width: 50%; background: #85cad3; color: rgb(24, 29, 0); display: flex; flex-direction: column; justify-content: center; text-align: center; align-items: center; line-height: 1.5;">
            <span id="all1" style="font-size: 15px;   text-align: center;">عرض الكل</span>
            <span id="all2" style="font-size: 12px; text-align: center;">( الأجدد أولاً )</span>
          </button>
          


          
        <select id="brandDropdown" style="margin: 20px 0; max-width: 50%; margin-left: 10PX; padding: 10px; font-size: 16px; border-radius: 8px; display: block; color: #4dabb8;">
          <option value="">جاري التحميل ...</option>
        </select>



        







      </div>





      </div>
    </div>

    
    
  
    

    <p id="message"></p>
    <p id="resultsCount"></p>
    <p id="welcomeText"></p>
    <div id="loading" class="spinner-container" style="display: none;">
      <div class="spinner"></div>
      <p>جاري التحميل...</p>
    </div>
    
    

    <div class="image-container">
      <img id="image1" />
      <p id="infoText"></p>
      <p id="image2" ></p>
    </div>

    <div id="externalLink">
      <a id="linkElement" href="#" target="_blank"></a>
    </div>

    <div id="searchResults"></div>
  </div>


  <script>





const flag = document.getElementById("flagIcon");

    

        if (lang === "ar") {


         


          document.getElementById('lan').textContent = "العربية";

          flag.src = "https://upload.wikimedia.org/wikipedia/commons/f/fe/Flag_of_Egypt.svg";

          document.getElementById('imageUrl').placeholder = "أدخل الكود";
          document.getElementById('searchButton').textContent = "بحث بالكود";

          document.getElementById('arabicSearch').placeholder = "ادخل : اسم الصنف  بيت الازياء  المكونات";
          document.getElementById('arabicSearchBtn').textContent = "بحث";

          document.getElementById('all1').textContent = "عرض الكل";
          document.getElementById('all2').textContent = "( الأجدد أولاً )";




        } else {


          document.body.style.direction="ltr";


          document.getElementById('lan').textContent = "En";

          flag.src = "https://upload.wikimedia.org/wikipedia/en/a/ae/Flag_of_the_United_Kingdom.svg";

          document.getElementById('searchRButton').style.marginLeft ="10px";
          document.getElementById('searchRButton').style.marginRight ="0px";

          document.getElementById('brandDropdown').style.marginLeft ="0px";
          document.getElementById('brandDropdown').style.marginRight ="10px";
          document.getElementById('brandDropdown').style.direction="ltr";
          document.getElementById('brandDropdown').style.textAlign="left";


            document.getElementById('imageUrl').placeholder = "Enter Code";
            document.getElementById('searchButton').textContent = "Search By Code";

            document.getElementById('arabicSearch').placeholder = "Enter : Name  Brand  Not’s";
            document.getElementById('arabicSearch').style.direction = "ltr";

            document.getElementById('arabicSearchBtn').textContent = "Search";

            document.getElementById('all1').textContent = "View All";
            document.getElementById('all2').textContent = "( Newest First )";


            document.getElementById('welcomeText').style.direction = "ltr";


        }


        if(localStorage.getItem("pNum") === "tanira"){
    document.getElementById('logoc').textContent = "Tanira";
  }
    </script>
</body>
</html>
