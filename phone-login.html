<!doctype html>
<html lang="ar">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>تسجيل الدخول برقم الهاتف</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="card">
  <h2>تسجيل الدخول برقم الهاتف</h2>
  <input id="phoneNumber" type="text" placeholder="+20XXXXXXXXX">
  <div id="recaptcha-container"></div>
  <button id="sendBtn">إرسال رمز التحقق</button>

  <div id="otpSection" class="hidden">
    <input id="otpCode" type="text" placeholder="رمز التحقق">
    <button id="verifyBtn">تحقق</button>
  </div>

  <div id="message" class="hidden"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
import { getAuth, RecaptchaVerifier, signInWithPhoneNumber } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyADi4u5lGHk9z6ZR8JyeQDkAkU2BFZcm00",
  authDomain: "arocode-dc99f.firebaseapp.com",
  projectId: "arocode-dc99f",
  storageBucket: "arocode-dc99f.appspot.com",
  messagingSenderId: "330058158570",
  appId: "1:330058158570:web:7bd409dd016a2951262293",
  databaseURL: "https://arocode-dc99f-default-rtdb.firebaseio.com"
};

// تهيئة Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

// إنشاء reCAPTCHA
const recaptchaVerifier = new RecaptchaVerifier('recaptcha-container', { size: 'invisible' }, auth);
await recaptchaVerifier.render();

const phoneInput = document.getElementById('phoneNumber');
const sendBtn = document.getElementById('sendBtn');
const otpSection = document.getElementById('otpSection');
const otpInput = document.getElementById('otpCode');
const verifyBtn = document.getElementById('verifyBtn');
const messageDiv = document.getElementById('message');

function showMessage(text, ok=true) {
  messageDiv.textContent = text;
  messageDiv.className = ok ? '' : 'toast';
  messageDiv.classList.remove('hidden');
}

sendBtn.addEventListener('click', async () => {
  const phoneNumber = phoneInput.value.trim();
  if (!phoneNumber) return showMessage('أدخل رقم الهاتف', false);
  try {
    window.confirmationResult = await signInWithPhoneNumber(auth, phoneNumber, recaptchaVerifier);
    otpSection.classList.remove('hidden');
    showMessage('تم إرسال الرمز.');
  } catch (err) {
    showMessage('خطأ: ' + err.message, false);
  }
});

verifyBtn.addEventListener('click', async () => {
  const code = otpInput.value.trim();
  if (!code) return showMessage('أدخل الرمز', false);
  try {
    const result = await window.confirmationResult.confirm(code);
    showMessage('تم التحقق بنجاح.');
  } catch (err) {
    showMessage('رمز خاطئ.', false);
  }
});
</script>
</body>
</html>
